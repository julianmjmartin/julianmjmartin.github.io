
<!DOCTYPE html>
<html>
<head>
<title>Alpha1</title>

<!-- EaselJS Framework -->
<script src="https://code.createjs.com/easeljs-0.6.0.min.js"></script>

<script>
    var canvas;
    var game;
    var screenWidth;
    var screenHeight;
	
    var bmpAnimation;
    var playerIdleAnimation;

    var numImagesLoaded = 0;
    var PlayerRunLeft = new Image();
    var PlayerIdle = new Image();

    function init() {
        //load canvas + images
        canvas = document.getElementById("gameCanvas");

        PlayerRunLeft.onload = imageLoad;
        PlayerRunLeft.onerror = imageError;
        PlayerRunLeft.src = "playerrunleft.png";

        PlayerIdle.onload = imageLoad;
        PlayerIdle.onerror = imageError;
        PlayerIdle.src = "player.png";
	   
    }

    function imageLoad(e) {
		//fixes INVALID_STATE_ERR (11) by loading images first -- make sure to update for however many images you add 
        numImagesLoaded++;
		
        if (numImagesLoaded == 2) {
            numImagesLoaded = 0;
            startGame();
        }
    }

    function reset() {
		//resets game
        game.removeAllChildren();
        createjs.Ticker.removeAllListeners();
        game.update();
    }

    function startGame() {
        //creates game at canvas
        game = new createjs.Stage(canvas);

        //canvas width/height for calculations
        screenWidth = canvas.width;
        screenHeight = canvas.height;

        //creating runLeft spritesheet 
        var spriteSheet = new createjs.SpriteSheet({
            //image used, width + hight + registration, and slowing animation down by 4x [in that order]
            images: [PlayerRunLeft],
            frames: { width: 64, height: 67, regX: 32, regY: 32 }, 
            animations: {
                runLeft: [0, 5, "runLeft", 4]
            }
        });

        //creating idle spritesheet [still a TODO]
        var spriteSheetIdle = new createjs.SpriteSheet({
			//image used, width + hight + registration, and slowing animation down by 4x [in that order]
            images: [PlayerIdle],
            frames: { width: 64, height: 67, regX: 32, regY: 32 }, 
            animations: {
                idle: [0, 11, "idle", 4]
            }
        });

        playerIdleAnimation = new createjs.BitmapAnimation(spriteSheetIdle);
        playerIdleAnimation.name = "playerIdle1";
        playerIdleAnimation.x = 16;
        playerIdleAnimation.y = 32;
	    
        bmpAnimation = new createjs.BitmapAnimation(spriteSheet);
        bmpAnimation.regX = bmpAnimation.spriteSheet.frameWidth / 2 | 0; //set registration point to center of sprite dimensions [the point it will be positioned and rotated around]
        bmpAnimation.regY = bmpAnimation.spriteSheet.frameHeight / 2 | 0;
        bmpAnimation.shadow = new createjs.Shadow("#454", 0, 5, 4);
        bmpAnimation.name = "player1";
        bmpAnimation.direction = 90;
        bmpAnimation.vX = 1;
        bmpAnimation.vY = 0;
        bmpAnimation.x = 16;
        bmpAnimation.y = 32;
        bmpAnimation.currentFrame = 1; //start at frame 1
        game.addChild(bmpAnimation);

		//60 FPS
        createjs.Ticker.addListener(window);
        createjs.Ticker.useRAF = true;
        createjs.Ticker.setFPS(60);
    }

    //called if there is an error loading the image (usually due to a 404)
    function imageError(e) {
        console.log("Error Loading Image : " + e.target.src);
    }

    function tick() {
        // Hit testing the screen width, otherwise our sprite would disappear
        if (bmpAnimation.x >= screenWidth - 16) {
            // We've reached the right side of our screen
            // We need to runLeft left now to go back to our initial position
            bmpAnimation.direction = -90;
            bmpAnimation.gotoAndPlay("runLeft")
        }

        if (bmpAnimation.x < 16) {
            // We've reached the left side of our screen
            // We need to runLeft right now
            bmpAnimation.direction = 90;
            bmpAnimation.gotoAndStop("runLeft");
            game.removeChild(bmpAnimation);
            playerIdleAnimation.gotoAndPlay("idle");
            game.addChild(playerIdleAnimation);
        }

        // Moving the sprite based on the direction & the speed
        if (bmpAnimation.direction == 90) {
            bmpAnimation.x += bmpAnimation.vX;
            bmpAnimation.y += bmpAnimation.vY;
        }
        else {
            bmpAnimation.x -= bmpAnimation.vX;
            bmpAnimation.y -= bmpAnimation.vY;
        }

        // update the game:
        game.update();
    }

</script>
</head>
	
<body>
	<div class="description">

	</div>
	<div class="canvasHolder">
		<canvas id="gameCanvas" width="240" height="64" style="background-color:#607559">
            Your browser doesn't support canvas. Please download IE9+ on <a href="http://ie.microsoft.com/testdrive">IE Test Drive</a> 
        </canvas>
	</div>
    <button id="Start" onclick=init();>Start</button><button id="Reset" onclick=reset();>Reset</button>
</body>
</html>
