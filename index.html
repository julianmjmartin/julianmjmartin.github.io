
<!DOCTYPE html>
<html>
<head>
<title>Alpha1</title>

<!-- EaselJS Framework -->
<script src="https://code.createjs.com/easeljs-0.6.0.min.js"></script>

<script>
    var canvas;
    var game;
    var screenWidth;
    var screenHeight;
	
    var runLeftAni;
    var playerIdleAni;

    var numImagesLoaded = 0;
    var PlayerRunLeft = new Image();
    var PlayerIdle = new Image();
	
    var KEYCODE_W = 87;
    var KEYCODE_A = 65;
    var KEYCODE_D = 68;
	
    var lfHeld;				
    var rtHeld;		
    var fwdHeld;
	
    var TURN_FACTOR = 7;

    document.onkeydown = handleKeyDown;
    document.onkeyup = handleKeyUp;

    function init() {
        //load canvas + images
        canvas = document.getElementById("gameCanvas");

        PlayerRunLeft.onload = imageLoad;
        PlayerRunLeft.onerror = imageError;
        PlayerRunLeft.src = "playerrunleft.png";

        PlayerIdle.onload = imageLoad;
        PlayerIdle.onerror = imageError;
        PlayerIdle.src = "player.png";
	   
    }

    function imageLoad(e) {
		//fixes INVALID_STATE_ERR (11) by loading images first -- make sure to update for however many images you add 
        numImagesLoaded++;
		
        if (numImagesLoaded == 2) {
            numImagesLoaded = 0;
            startGame();
        }
    }

    function reset() {
		//resets game
        game.removeAllChildren();
        createjs.Ticker.removeAllListeners();
        game.update();
    }

    function startGame() {
        //creates game at canvas
        game = new createjs.Stage(canvas);

        //canvas width/height for calculations
        screenWidth = canvas.width;
        screenHeight = canvas.height;

        //creating runLeft spritesheet 
        var spriteSheetRunLeft = new createjs.SpriteSheet({
            //image used, width + hight + registration, and slowing animation down by 4x [in that order]
            images: [PlayerRunLeft],
            frames: { width: 64, height: 67, regX: 32, regY: 32 }, 
            animations: {
                runLeft: [0, 5, "runLeft", 4]
            }
        });

        //creating idle spritesheet [still a TODO]
        var spriteSheetRunLeftIdle = new createjs.SpriteSheet({
			//image used, width + hight + registration, and slowing animation down by 4x [in that order]
            images: [PlayerIdle],
            frames: { width: 64, height: 67, regX: 32, regY: 32 }, 
            animations: {
                idle: [0, 0, "idle", 4]
            }
        });

        playerIdleAni = new createjs.BitmapAnimation(spriteSheetRunLeftIdle);
        playerIdleAni.name = "playerIdle1";
        playerIdleAni.x = 16;
        playerIdleAni.y = 32;
	    
        runLeftAni = new createjs.BitmapAnimation(spriteSheetRunLeft);
        runLeftAni.regX = runLeftAni.spriteSheet.frameWidth / 2 | 0; //set registration point to center of sprite dimensions [the point it will be positioned and rotated around]
        runLeftAni.regY = runLeftAni.spriteSheet.frameHeight / 2 | 0;
        runLeftAni.shadow = new createjs.Shadow("#454", 0, 5, 4);
        runLeftAni.name = "player1";
        runLeftAni.direction = 90;
        runLeftAni.vX = 1;
        runLeftAni.vY = 0;
        runLeftAni.x = 16;
        runLeftAni.y = 32;
        runLeftAni.currentFrame = 1; //start at frame 1
        game.addChild(runLeftAni);

		//60 FPS
        createjs.Ticker.addListener(window);
        createjs.Ticker.useRAF = true;
        createjs.Ticker.setFPS(60);
    }

    //called if there is an error loading the image (usually due to a 404)
    function imageError(e) {
        console.log("Error Loading Image : " + e.target.src);
    }
    
    function handleKeyDown(e) {
	//cross browser issues exist
	if (!e) {
		var e = window.event;
	}
	switch (e.keyCode) {
		//case KEYCODE_SPACE:
			//shootHeld = true;
			//return false;
		case KEYCODE_A:
		//case KEYCODE_LEFT:
			console.log("working")
			lfHeld = true;
			return false;
		case KEYCODE_D:
		//case KEYCODE_RIGHT:
			console.log("working")
			rtHeld = true;
			return false;
		case KEYCODE_W:
		//case KEYCODE_UP:
			console.log("working")
			fwdHeld = true;
			return false;
		//case KEYCODE_ENTER:
			/*if (canvas.onclick == handleClick) {
				handleClick();
			}
			return false;*/
	}
    }
	
    function handleKeyUp(e) {
	//cross browser issues exist
	if (!e) {
		var e = window.event;
	}
	switch (e.keyCode) {
		//case KEYCODE_SPACE:
			//shootHeld = false;
			//break;
		case KEYCODE_A:
		//case KEYCODE_LEFT:
			console.log("up")
			lfHeld = false;
			break;
		case KEYCODE_D:
		//case KEYCODE_RIGHT:
			console.log("up")
			rtHeld = false;
			break;
		case KEYCODE_W:
		//case KEYCODE_UP:
			console.log("up")
			fwdHeld = false;
			break;
	}
}
	
    function tick() {
        // Hit testing the screen width, otherwise our sprite would disappear
	
	if (lfHeld || rtHeld) {
	    runLeftAni.direction = -90;
            runLeftAni.gotoAndPlay("runLeft")
	    console.log("working")
	}
	
      /*  if (runLeftAni.x >= screenWidth - 16) {
            // We've reached the right side of our screen
            // We need to runLeft left now to go back to our initial position
            runLeftAni.direction = -90;
            runLeftAni.gotoAndPlay("runLeft")
        }

        if (runLeftAni.x < 16) {
            // We've reached the left side of our screen
            // We need to run right now
            runLeftAni.direction = 90;
            runLeftAni.gotoAndStop("runLeft");
            game.removeChild(runLeftAni);
            playerIdleAni.gotoAndPlay("idle");
            game.addChild(playerIdleAni);
        }
*/
        // Moving the sprite based on the direction & the speed
        if (runLeftAni.direction == 90) {
            runLeftAni.x += runLeftAni.vX;
            runLeftAni.y += runLeftAni.vY;
        }
        else {
            runLeftAni.x -= runLeftAni.vX;
            runLeftAni.y -= runLeftAni.vY;
        } 

        // update the game:
        game.update();
    }

</script>
</head>
	
<body>
	<div class="description">

	</div>
	<div class="canvasHolder">
		<canvas id="gameCanvas" width="500" height="500" style="background-color:#607559">
            Your browser doesn't support canvas. Please download IE9+ on <a href="http://ie.microsoft.com/testdrive">IE Test Drive</a> 
        </canvas>
	</div>
    <button id="Start" onclick=init();>Start</button><button id="Reset" onclick=reset();>Reset</button>
</body>
</html>
